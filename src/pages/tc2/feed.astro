---
import AdvRedirector from "@components/AdvRedirector.astro";
import Body from "@components/Body.astro";
import Footer from "@components/Footer.astro";
import BaseHead from "@components/head/BaseHead.astro";
import ImportHead from "@components/head/ImportHead.astro";
import MainHead from "@components/head/MainHead.astro";
import PreloadHead from "@components/head/PreloadHead.astro";
import tfLogoImg from "@img/tc2/team-comtress-2.png";
import Layout from "@layouts/Layout.astro";
import { getCollection } from "astro:content";

const news = (await getCollection("tc2News"))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .filter((post) => !post.data.draft);

const patches = (await getCollection("tc2Patches"))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf() || (b.data.num ?? 1) - (a.data.num ?? 1))
  .filter((post) => !post.data.draft && !post.id.endsWith("beta"));
---

<Layout>
  <head>
    <BaseHead />
    <PreloadHead />
    <ImportHead />
    <MainHead
      title=`News Feed | Team Comtress 2`
      site="Team Comtress"
      noSite={true}
      description="Latest news and updates for Team Comtress 2"
      image="https://teamcomtress.com/img/tc2/team-comtress-2.png"
      favicon="/img/tc2/favicon.ico"
    />
  </head>
  <Body>
    <AdvRedirector />
    <div class="text-center p-4">
      <a href="/">
        <img
          class="img-logo-sm"
          src={tfLogoImg.src}
          alt="Team Comtress 2 logo"
        />
      </a>
    </div>

    <section class="container p-4 bg-dark mb-4">
      <h1 id="news">All News</h1>
      <div class="row gy-4 gx-0 ms-0">
        {
          news.map((post) => (
            <div class="card me-4 col-5">
              <div class="card-body">
                <h5 class="card-title" style="color: #fff;font-weight: 600">
                  {post.data.title}
                </h5>
                <p class="card-text" style="color: #c2c2c2">
                  {post.data.description}
                  <br />
                  <small class="text-muted">
                    <a
                      class="stretched-link"
                      href={
                        post.data.update
                          ? `/updates/${post.data.update}`
                          : `/news/${post.id}`
                      }
                    >
                      Read more Â»
                    </a>
                  </small>
                </p>
              </div>
              <div class="card-footer mb-2">
                <small class="text-muted">
                  {post.data.date.toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                    timeZone: "UTC",
                  })}
                </small>
              </div>
            </div>
          ))
        }
      </div>
      <hr />
      <h1 id="patches">All Patches</h1>
      <div class="row g-2 mt-1">
        {
          patches.map((post) => (
            <div class="col-3 pe-1">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title m-0 text-center">
                    <a class="stretched-link" href={`/patches/${post.id}`}>
                      {post.data.date.toLocaleDateString("en-US", {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                        timeZone: "UTC",
                      })}{post.data.num ? ` #${post.data.num}` : ""}
                    </a>
                  </h5>
                </div>
              </div>
            </div>
          ))
        }
      </div>
      <p class="mt-4">
        Looking for beta patch notes? Check out the <a href="/beta_patches"
          >beta test patch list</a
        >.
      </p>
    </section>
    <Footer product={"Team Comtress"} />
  </Body>
</Layout>
